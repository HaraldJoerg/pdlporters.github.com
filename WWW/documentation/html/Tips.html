    <HTML> 
	<HEAD> 
	    <TITLE>PDL::Tips - Small tidbits of useful arcana. Programming tidbits and such.

</TITLE> 
	</HEAD>

	<BODY>

<!-- INDEX BEGIN -->

<UL>

	<LI><A HREF="#NAME">NAME</A>
	<LI><A HREF="#SYNOPSIS">SYNOPSIS</A>
	<LI><A HREF="#DESCRIPTION">DESCRIPTION</A>
	<UL>

		<LI><A HREF="#Indexing_idioms">Indexing idioms</A>
		<LI><A HREF="#What_is_actually_happening_">What is actually happening?</A>
		<LI><A HREF="#Memory_savings">Memory savings</A>
		<LI><A HREF="#PP_speed">PP speed</A>
	</UL>

	<LI><A HREF="#AUTHOR">AUTHOR</A>
</UL>
<!-- INDEX END -->

<HR>
<P>
<H1><A NAME="NAME">NAME

</A></H1>
PDL::Tips - Small tidbits of useful arcana. Programming tidbits and such.


<P>

<P>
<HR>
<H1><A NAME="SYNOPSIS">SYNOPSIS

</A></H1>
<PRE>        use PDL;
</PRE>

<P>

<PRE>        # Whatever happens here.
</PRE>

<P>

<P>
<HR>
<H1><A NAME="DESCRIPTION">DESCRIPTION

</A></H1>
This page documents useful idioms, helpful hints and tips for using Perl
Data Language v2.0.


<P>

<P>
<HR>
<H2><A NAME="Indexing_idioms">Indexing idioms

</A></H2>
The following code normalizes a bunch of vectors in $a. This works
regardless of the dimensionality of $a.


<P>

<PRE>        $a /= $a-&gt;sumover-&gt;dummy(0);
</PRE>

<P>

<P>
<HR>
<H2><A NAME="What_is_actually_happening_">What is actually happening?

</A></H2>
If you want to see what the code is actually doing, try the command


<P>

<PRE>        PDL::Core::set_debugging(1);
</PRE>

<P>

somewhere. This spews out a huge amount of debug info for PDL into STDOUT.
It is planned to eventually make this redirectable and the messages
selectable more accurately.


<P>

Many of the messages come from <CODE>Basic/Core/pdlapi.c</CODE> and you can look at the source to see what is going on.


<P>

If you have any extra time to work on these mechanisms, infrom the
pdl-porters mailing list.


<P>

<P>
<HR>
<H2><A NAME="Memory_savings">Memory savings

</A></H2>
If you are running recursively something that selects certain indices of a
large piddle, like


<P>

<PRE>        while(1) {
                $inds = where($a&gt;0);
                $a = $a-&gt;index($inds);
                $b = $b-&gt;index($inds);
                func($b,$a);
        }
</PRE>

<P>

If you are not writing to $b, it saves a lot of memory to change this to


<P>

<PRE>                $b = $b-&gt;index($inds)-&gt;sever;
</PRE>

<P>

The new method <CODE>sever</CODE> is a causes the write-back relation to be forgotten. It is like copy except
it changes the original piddle and returns it).


<P>

Of course, the probably best way to do the above is


<P>

<PRE>        $inds = xvals ($a-&gt;long);
        while(1) {
                $inds0 = where($a&gt;0);
                $inds1 = $inds-&gt;index($inds)-&gt;sever;
                $a = $a0-&gt;index($inds1);
                $b = $b-&gt;index($inds1)-&gt;sever;
                func($b,$a);
        }
</PRE>

<P>

which doesn't save all the temporary instances of <CODE>$a</CODE> in
memory. See <CODE>mandel.pl</CODE> in the Demos subdirectory of the PerlDL distribution for an example.


<P>

<P>
<HR>
<H2><A NAME="PP_speed">PP speed

</A></H2>
If you really want to write speedy PP code, the first thing you need to do
is to make sure that your C compiler is allowed to do the necessary
optimizations.


<P>

What this means is that you have to allow as many variables as possible to
go into registers:


<P>

<PRE>        loop(a) %{
                $a() += $COMP(foo_member) * $b()
        %}
</PRE>

<P>

expands to


<P>

<PRE>        for(i=0; i&lt;10000; i++) {
                a[i] += __privtrans-&gt;foo_member * b[i];
        }
</PRE>

<P>

is about the worst you can do, since your C compiler is not allowed to
assume that <CODE>a</CODE> doesn't clobber <CODE>foo_member</CODE>
which completely inhibits vectorization. Instead, do


<P>

<PRE>        float foo = $COMP(foo_member);
        loop(a) %{
                $a() += foo * $b();
        %}
</PRE>

<P>

This is not a restriction caused by PP but by ANSI C semantics. Of course,
we could copy the struct into local varibles and back but that could cause
very strange things sometimes.


<P>

There are many other issues on organizing loops.


<P>

We are currently planning to make PP able to do fixed-width things as well
as physical piddles (where looping over the first dimensions would be
cheaper as there are less distinct increments, which might make a
difference on machines with a small number of registers).


<P>

<P>
<HR>
<H1><A NAME="AUTHOR">AUTHOR

</A></H1>
Copyright (C) Tuomas J. Lukka 1997. All rights reserved. Duplication in the
same form and printing a copy for yourself allowed.


<P>

</DL>
    </BODY>

    </HTML>
