<h1 class='title'>PDL Users</h1>

<p>PDL is useful in many fields, and has a diverse user community.
Below are examples of some interesting work done with PDL around the world.</p>

<!--
<h2>Some PDL success stories</h2>
-->
<dl>
  <dt>Astronomy and Astrophysics</dt>
  <dd>
   <ul>
    <li><a href="#magnetic">Artificial vision of magnetic fields on the Sun</a></li>
    <li><a href="#galaxy-gas">High-speed galactic winds</a></li>
    <li><a href="#glazebrook">Identifying galaxies from telescope images</a></li>
   </ul>
  </dd>

  <dt>Meteorology and Terrestrial Monitoring</dt>
  <dd>
   <ul>
    <li><a href="#ece">Measuring European air pollution for the U.N.</a></li>
    <li><a href="#sat-viz">Real-time weather and forest fire detection from space</a></li>
   </ul>
  </dd>

  <dt>Medical imaging</dt>
  <dd>
   <ul>
     <li><a href="#brain">Brain scan visualization</a></li>
   </ul>
  </dd>
</dl>

<hr/>

<h3 id="magnetic">Artificial vision of magnetic fields</h3>

<p>I and my graduate student use PDL to track thousands of magnetic features
on the Sun. The churning surface of the Sun is covered by magnetic north and
south poles that are constantly emerging, moving, recombining, and dissipating.
Special telescopes called <em><a href="http://soi.stanford.edu">magnetographs
</a></em> can view these poles as black and white spots, allowing us to probe
the Sun's dynamo. PDL's Transform package made it easy for us to remove
perspective effects from <a href="http://sohowww.nascom.nasa.gov">spacecraft
data</a>, and to write an artificial vision application to identify
every magnetic feature in the field of view.</p>

<p>What's more, PDL is free -- so we can distribute
<a href="http://www.boulder.swri.edu/swamis">our software</a> for anyone to use.</p>

<p><em>--Craig DeForest, deforest (at) boulder (dot) swri (dot) edu</em></p>

<table cellpadding="15px">
  <tr>
    <td>
      <div align="center">
        <a href="images/nifty/mag-qtm.mpg">
          <img src="images/nifty/mag-qtm.png" height="300" width="300" />
        </a>
      </div>
      
      <p>Tracked magnetogram shows about 1/10 of the surface of the Sun,
      reprojected to appear as if you're hovering immediately over it
      (click for movie). Our software has identified and numbered every
      statistically significant feature.</p>
	</td>
	
	<td>
	  <div align="center">
	    <a href="images/nifty/mag-qcm.mpg">
	      <img src="images/nifty/mag-qcm.png" height="300" width="300" />
	    </a>
	  </div>
	  
      <p>Here, poles that appear in N/S pairs are marked by yellow
      highlights. Single north or south pole appearances (in apparent
      but not real violation of physics) are marked by blue highlights.
      Flux is emerging on scales too small for the telescope to fully
      resolve it.</p>
    </td>
  </tr>
</table>

<hr/>

<table>
  <tr>
    <td>
<h3 id="galaxy-gas">High speed galactic winds</h3>

<p>I did much of the data analysis for my Ph.D. thesis using PDL, and got an 
<a href="http://www.umich.edu/news/index.html?Releases/2004/Jan04/r010604">
AAS press release</a> out of it. I never imagined being able to manipulate
3-D radio science datacubes in Perl until I met PDL. Thanks!</p>

<p>This optical image of the Whirlpool Galaxy (M51) shows the regions
of high speed galactic winds that I discovered.</p>

<p><em>--Eric Miller ( milleric (at) space (dot) mit (dot) edu )</em></p>
    </td>
    <td>
      <img src="images/nifty/galaxy-sm.jpg" style="padding: 1em;"
           width="250" height="250" />
    </td>
  </tr>
</table>

<hr/>

<h3 id="glazebrook">Star Formation throughout the Universe</h3>

<p> As a professional astrophysicist, I have analyzed countless types of data
using PDL. Here is one example: In 1997 I collected some very deep-field
images of the <a href="http://www.stsci.edu/ftp/science/hdf/hdf.html">Hubble
Deep Field</a> using the Taurus Tunable Filter and the 4m
<a href="http://www.ing.iac.es/Astronomy/telescopes/wht/">William Herschel
Telescope</a> in La Palma. The tunable filter produces 3-D data
(x,y,wavelength) that are difficult to analyze with conventional astronomical
software. I reduced my data entirely with home-brew PDL scripts that identified
galaxies and separated them by wavelength and position. The slicing, dicing,
rapid prototyping, and "glue" features of PDL and Perl were all used to the max.
</p>


<p> This figure is from a <a href="http://adsabs.harvard.edu/cgi-bin/nph-bib_query?bibcode=2004AJ....128.2652G&amp;db_key=AST&amp;high=425327f64719038">
paper</a> that I and some colleagues published in the Astronomical
Journal, showing emission line galaxies that we found in the data
cube (using another PDL script). Such galaxies have excess emission
at one wavelength due to nebular emission from young stars creating an
ionized nebula. Each row shows a single galaxy at several different
wavelengths, and the graph to the right shows the total brightness of
the galaxy at each wavelength. These galaxies are at distances of
5,000 - 10,000 million light years. We used these data to estimate the
formation rate of stars throughout much of the history of the Universe.
</p>

<center>
  <a href="images/nifty/kgb-figure.png">
    <img src="images/nifty/kgb-figure-small.png" width="660" height="228" />
  </a>
</center>

<p>One interesting fact: the original PDL script used to make this figure
(on a Sparc 20 workstation) in 1998 still worked unchanged (on a G5 Mac)
in 2004 when the final paper was submitted!</p>

<p> <em>--Karl Glazebrook, kgb (at) pha (dot) jhu (dot) edu</em>


<hr/>

<h3 id="ece">Measuring European air pollution for the U.N.</h3>

<table>
  <tr>
    <td>
      <p>The UN-ECE's <a href="https://www.emep.int">EMEP</a> program monitors
      long-range air pollutants such as acid rain and ozone, over the whole
      of Europe. The results are used to create international laws and
      accords such as the Gothenborg protocol. Our FORTRAN code models
      pollutant motion and chemistry throughout Europe, producing about
      50 GB of netcdf data for each year studied.</p>
    
      <p>Comparing these data with other data sources, extracting
      country-based data from the physical grid, and preparing statistics
      required a powerful, memory-efficient, flexible data language. PDL
      gave us exactly what we needed. We even used it to generate
      automated reports for each of 50 countries.</p>

      <p><em>--Heiko Klein, Heiko.Klein (at) gmx (dot) net</em>
    </td>
   
    <td>
      <img style="padding: 1em" width="370px" height="295px"
           src="images/nifty/ece-emission.jpg"/>
    </td>
  </tr>
</table>

<center>
  <img src="images/nifty/ece-sox2.png" width="619px" height="151px"/>
</center>


<hr/>

<h3 id="sat-viz">Forest fire detection</h3>

<table>
  <tr>
    <td>
      <p>At the <a href="http://www.latuv.uva.es">Remote Sensing Laboratory
      of the University of Valladolid</a>, we combine data from several
      satellites to produce real-time images of Spain and surroundings as a
      public service. Among other services, we can detect forest fires from
      satellite images within a few minutes, in time to alert regional
      authorities. Our pipeline includes 20 steps, some compiled in C and
      FORTRAN and others in Perl and Perl/PDL. Our results are published on the web and emailed to
      Televisi&oacute;n Espa&ntilde;ola where they are made available via
      the national teletext service. <p> At right is an image of spain with
      several potential wildfires marked in red. Their locations are listed at
      far right. The various aqua-colored outlines are regions that were
      photographed by different satellites.</p>

     <p><em>-- Joaquin Ferrero, explorer (at) latuv (dot) uva (dot) es</em></p>
    </td>
    <td>
      <a href="images/nifty/forest-lg.jpg">
        <img src="images/nifty/forest-sm.jpg" style="padding: 1em;"
             width="353px" height="250px"/>
      </a>
    </td>
  </tr>
</table>

<hr/>

<h3 id="brain">Visualization of my brain</h3>

<p><a href="http://www.jonaskaplan.com/perlfmri.php">perlfMRI</a> is
a very simple tool I created for viewing functional MRI data, written
entirely in perl with PDL. What's nice about it is that it lets you
simultaneously view three planes through the brain and to rotate them
in 3d (see below). These images are showing my own brain, overlain
with activations in my auditory cortex while I listened to music.
They were created under MacOS X.</p>

<p><em>--Jonas Kaplan ( jonask (at) ucla (dot) edu )</em></p>

<center>
  <table cellspacing="10px">
    <tr>
      <td>
        <center>
          <img src="images/nifty/brain-1.jpg" width="123px" height="125px"/>
          <img src="images/nifty/brain-2.jpg" width="117px" height="88px">
        </center>
      </td>
      <td>
        <img src="images/nifty/brain-3.jpg" width="236px" height="250px"/>
      </td>
      <td>
        <img src="images/nifty/brain-4.jpg" width="300px" height="197px"/>
      </td>
    </tr>
  </table>
</center>


<script type="text/javascript">
	var cm_map;
	var cm_mapMarkers = [];
	var cm_mapHTMLS = [];

	// Create a base icon for all of our markers that specifies the
	// shadow, icon dimensions, etc.
	var cm_baseIcon = new GIcon();
	cm_baseIcon.shadow = "http://www.google.com/mapfiles/shadow50.png";
	cm_baseIcon.iconSize = new GSize(20, 34);
	cm_baseIcon.shadowSize = new GSize(37, 34);
	cm_baseIcon.iconAnchor = new GPoint(9, 34);
	cm_baseIcon.infoWindowAnchor = new GPoint(9, 2);
	cm_baseIcon.infoShadowAnchor = new GPoint(18, 25);

	// Params to get the map data from the spreadsheet
	var param_wsId = "od6";
	var param_ssKey = "0Am3SSF48QCE9dERjcko2YWNrSzJVLUZLd1QyaldsYXc";
	var param_useSidebar = false;
	var param_titleColumn = "place";
	var param_descriptionColumn = "discipline";
	var param_latColumn = "latitude";
	var param_lngColumn = "longitude";
	var param_rankColumn = "users";
	var param_iconType = "green";
	var param_iconOverType = "orange";
	
	cm_load();

/**
 * Loads map and calls function to load in worksheet data.
 */
function cm_load() {  
	if (GBrowserIsCompatible()) {
	
		// create the map
		cm_map = new GMap2(document.getElementById("cm_map"));
		cm_map.addControl(new GLargeMapControl());
		cm_map.addControl(new GMapTypeControl());
		cm_map.setCenter(new GLatLng( 43.907787,-79.359741), 1, G_SATELLITE_MAP);
		
		cm_getJSON();
	}
	else {
		alert("Sorry, the Google Maps API is not compatible with this browser");
	} 
}

/**
 * Function called when marker on the map is clicked.
 * Opens an info window (bubble) above the marker.
 * @param {Number} markerNum Number of marker in global array
 */
function cm_markerClicked(markerNum) {
	cm_mapMarkers[markerNum].openInfoWindowHtml(cm_mapHTMLS[markerNum]);
}

/**
 * Function that sorts 2 worksheet rows from JSON feed
 * based on their rank column. Only called if column is defined.
 * @param {rowA} Object Represents row in JSON feed
 * @param {rowB} Object Represents row in JSON feed
 * @return {Number} Difference between row values
 */
function cm_sortRows(rowA, rowB) {
	var rowAValue = parseFloat(rowA["gsx$" + param_rankColumn].$t);
	var rowBValue = parseFloat(rowB["gsx$" + param_rankColumn].$t);
	
	return rowAValue - rowBValue;
}

/** 
 * Called when JSON is loaded. Creates sidebar if param_sideBar is true.
 * Sorts rows if param_rankColumn is valid column. Iterates through worksheet rows, 
 * creating marker and sidebar entries for each row.
 * @param {JSON} json Worksheet feed
 */       
function cm_loadMapJSON(json) {
	var usingRank = false;
	
	if (param_useSidebar == true) {
		var sidebarTD = document.createElement("td");
		sidebarTD.setAttribute("width","150");
		sidebarTD.setAttribute("valign","top");
		var sidebarDIV = document.createElement("div");
		sidebarDIV.id = "cm_sidebarDIV";
		
		sidebarDIV.style.overflow = "auto";
		sidebarDIV.style.height = "300px";
		sidebarDIV.style.fontSize = "11px";
		sidebarDIV.style.fontFamily = "sans-serif";
		sidebarDIV.style.lineHeight = "11px";
		sidebarDIV.style.marginTop = "5px";
		sidebarTD.appendChild(sidebarDIV);
		document.getElementById("cm_mapTR").appendChild(sidebarTD);
	}
	
	var bounds = new GLatLngBounds();
	
	if(json.feed.entry[0]["gsx$" + param_rankColumn]) {
		usingRank = true;
		json.feed.entry.sort(cm_sortRows);
	}

	for (var i = 0; i < json.feed.entry.length; i++) {
		var entry = json.feed.entry[i];
		if (entry["gsx$" + param_latColumn]) {
			var lat = parseFloat(entry["gsx$" + param_latColumn].$t);
			var lng = parseFloat(entry["gsx$" + param_lngColumn].$t);
			var point = new GLatLng(lat,lng);
			var html = "<div style='font-size:12px; font-family: sans-serif;'>";
			html += "<b>" + entry["gsx$"+param_titleColumn].$t + "</b>";
			var label = entry["gsx$"+param_titleColumn].$t + " (" + entry["gsx$"+param_descriptionColumn].$t + ")";
			var rank = 0;
			
			if(usingRank && entry["gsx$" + param_rankColumn]) {
				rank = parseInt(entry["gsx$"+param_rankColumn].$t);
			}
			
			if(entry["gsx$" + param_descriptionColumn]) {
				html += "<br/>" + entry["gsx$"+param_descriptionColumn].$t;
			}
			html += "</div>";
			
			// create the marker
			var marker = cm_createMarker(point,label,html,rank);
			cm_map.addOverlay(marker);
			cm_mapMarkers.push(marker);
			cm_mapHTMLS.push(html);
			bounds.extend(point);
			
			if(param_useSidebar == true) {
				var markerA = document.createElement("a");
				markerA.setAttribute("href","javascript:cm_markerClicked('" + i +"')");

				var sidebarText= "";
				if(usingRank) {
					sidebarText += rank + ") ";
				} 
				sidebarText += label;
				markerA.appendChild(document.createTextNode(sidebarText));
				sidebarDIV.appendChild(markerA);
				sidebarDIV.appendChild(document.createElement("br"));
				sidebarDIV.appendChild(document.createElement("br"));
			}
		}
	}
}

/**
 * Creates marker with ranked Icon or blank icon,
 * depending if rank is defined. Assigns onclick function.
 * @param {GLatLng} point Point to create marker at
 * @param {String} title Tooltip title to display for marker
 * @param {String} html HTML to display in InfoWindow
 * @param {Number} rank Number rank of marker, used in creating icon
 * @return {GMarker} Marker created
 */
function cm_createMarker(point, title, html, rank) {
	var markerOpts = {};
	var nIcon = new GIcon(cm_baseIcon);
	
	var markers_url = "http://gmaps-samples.googlecode.com/svn/trunk/markers/";
	if (rank > 0 && rank < 100) {
		nIcon.imageOut = markers_url + param_iconType + "/marker" + rank + ".png";
		nIcon.imageOver = markers_url + param_iconOverType + "/marker" + rank + ".png";
		nIcon.image = nIcon.imageOut; 
	} 
	else { 
		nIcon.imageOut = markers_url + param_iconType + "/blank.png";
		nIcon.imageOver = markers_url + param_iconOverType + "/blank.png";
		nIcon.image = nIcon.imageOut;
	}

	markerOpts.icon = nIcon;
	markerOpts.title = title;		 
	var marker = new GMarker(point, markerOpts);
	
	GEvent.addListener(marker, "click", function() {
		marker.openInfoWindowHtml(html);
	});
	GEvent.addListener(marker, "mouseover", function() {
		marker.setImage(marker.getIcon().imageOver);
	});
	GEvent.addListener(marker, "mouseout", function() {
		marker.setImage(marker.getIcon().imageOut);
	});
	GEvent.addListener(marker, "infowindowopen", function() {
		marker.setImage(marker.getIcon().imageOver);
	});
	GEvent.addListener(marker, "infowindowclose", function() {
		marker.setImage(marker.getIcon().imageOut);
	});
	return marker;
}

/**
 * Creates a script tag in the page that loads in the 
 * JSON feed for the specified key/ID. 
 * Once loaded, it calls cm_loadMapJSON.
 */
function cm_getJSON() {

	// Retrieve the JSON feed.
	var script = document.createElement('script');
	
	script.setAttribute(
		'src',
		'http://spreadsheets.google.com/feeds/list/' + param_ssKey + '/' + param_wsId + '/public/values' + '?alt=json-in-script&callback=cm_loadMapJSON'
	);
	script.setAttribute('id', 'jsonScript');
	script.setAttribute('type', 'text/javascript');
	document.documentElement.firstChild.appendChild(script);
}

//setTimeout('cm_load()', 500); 

//]]>
</script>

